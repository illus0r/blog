---
published: true
title: Перевёрстка данных о миграции
permalink: all/perevyorstka-dannyh-o-migracii/
---

Росстат нарисовал такое:

![]({{site.baseurl}}/media/makeover-migration.jpg)

Округи можно вывести списком, не обязательно привязывать к карте. Стрелки всё окончательно запутывают: почему они делятся на сегменты? Важен ли их цвет? Куда уехало больше всего жителей ЦФО? Какой процент людей уезжает?

Было бы круче показать таблицей. В строках — откуда, в столбцах — куда уезжают. В исходной визуализации такой инфы нет. 

Нажожу исходные данные [на сайте Росстата](http://www.gks.ru/wps/wcm/connect/rosstat_main/rosstat/ru/statistics/population/demography/). Да они прекрасны, всё как я и хотел :–) Даже больше: тут инфа разбита на городские и сельские поселения. По каждому федеральному округу можно посмотреть, сколько человек переехало из сёл в города, а сколько из городов в сёла.

![]({{site.baseurl}}/media/makeover-migration-gks.png)

Попробую для начала визуализировать в Табло. Сейчас данные в виде разреженной таблицы, надо сделать её плотной. То есть такой, чтобы в каждой строке было указано: из какого ФО, из города или из села, сколько человек переехало, в какой ФО, в город или в село. Часть работы делаю вручную:

![]({{site.baseurl}}/media/makeover-data-cleanup.png)

Выделенными данными надо заполнить столбцы to_district и amount. Тогда в каждой строке будет по одному числовому значению, как нам и надо. Вручную делать это долго, к счастью, Табло умеет так:

![]({{site.baseurl}}/media/makeover-migration-pivot.png)

Ррраз — и данные в правильном формате:

![]({{site.baseurl}}/media/makeover-data-dense.png)

Здорово. Попробуем визуализировать:

![]({{site.baseurl}}/media/makeover-migration-tableau-0.png)

Теперь посмотрим миграцию между сёлами и городами:

![]({{site.baseurl}}/media/makeover-migration-tableau-2.png)

В диагональных ячейках, вероятно, показано, сколько человек переехало внутри своего ФО, оставаясь в городской или сельской местности. То есть, из города в другой город, или из села в другое село.

Уберём переезды внутри своего ФО, чтобы внимательнее рассмотреть остальные:

![]({{site.baseurl}}/media/makeover-migration-tableau-3.png)

Чтобы цветовая палитра была ближе к действительности, лучше сдвинуть так, чтобы нулевые значения были белыми. Тогда число в ячейке будет пропорционально количеству синей краски:

![]({{site.baseurl}}/media/makeover-migration-tableau-5.png)

В данных Росстата есть информация за несколько лет, почему бы не показать динамику изменения миграции? Перевожу остаток данных Росстата в нужный формат при помощи Vim и Табло, рисую гарфики:

![]({{site.baseurl}}/media/makeover-migration-ts.png)

Площадь графика показывает число переездов за все годы. Видим, что в 11 году все дружно начали переезжать
{:.caption}

![]({{site.baseurl}}/media/makeover-migration-ts_to_other.png)

Если оставить только переезды в другие регионы, будет так
{:.caption}

Между делом показываю результат [Роме Бунину](http://revealthedata.com/), он предлагает попробовать санки чарт. И показать всё-таки карту России. Пробую санки:

![]({{site.baseurl}}/media/makeover-migration-sankey.png)

Справа порядок неправильный, не стал пока исправлять
{:.caption}

Слева — сколько уехало из округа, справа — сколько приехало. Клёво, что все потоки видны и что они похожи именно на потоки. Если с таблицей надо разбираться, тут сразу видно, что что-то куда-то перетекает. А если не повторять каждый регион по два раза? Пробую вариант с chord diagram, которую собираю [в онлайн-генераторе](http://mkweb.bcgsc.ca/tableviewer/visualize/):

![]({{site.baseurl}}/media/makeover-migration-chord.png)

Даже если не обращать внимания на весь обвес, стало слишком сложно. В середине каша. А ещё в подобных диаграммах потоки в середине становятся тоньше. Такое решение улучшает читаемость, но искажает данные.

Тупик. Запоздало иду искать аналогичные визуализации.

![]({{site.baseurl}}/media/makeover-migration-analogue-animated.gif)

[Визуализация Метрокосма](http://metrocosm.com/global-immigration-map/)
{:.caption}

![]({{site.baseurl}}/media/makeover-migraion-analogue_arrows.jpg)

Красиво, но если показать миграции между всеми штатами, будет каша
{:.caption}

Плюс много санки и chord:

![]({{site.baseurl}}/media/makeover-migration-analogues-sankey_chord.png)

Делаю десяток набросков, в голову приходит странный вариант: а что, если сделать аналог [плиточной карты](http://dianov.org/all/plitochnaya-karta-rossii/) для округов? Прототипирую в табло:

![]({{site.baseurl}}/media/makeover-migration-tilemap-from.png)

«Карта» состоит из восьми клеток-округов. Внутри каждого округа — такая же карта округов. Чтобы узнать, из какого округа чаще всего переезжают в ЦФО, надо выбрать в клетке ЦФО самый большой кружок. И посмотреть, какой округ он означает. Переезды внутри региона показываю серыми кружками.

Экспортирую из Табло ПДФ и допиливаю в Скетче:

![]({{site.baseurl}}/media/makeover-migration-bubbles.png)

Показываю [Андрею Ересу](http://andreieres.ru/). Оказывается, ничего не понятно, надо было раньше показать :–\

Решаю вернуться к старой версии с таблицей. Пробую импортнуть ПДФ из Табло в Скетч, но всё очень тормозит. Поэтому визуализирую на d3, дорабатываю в Скетче:

![]({{site.baseurl}}/media/makeover-migration-d3-prettified.png)

![]({{site.baseurl}}/media/makeover-migration-im-eres.png)

Доработать не успеваю, решаю на этом закончить. Клёво было бы ещё показать численность населения округов и её прирост.
